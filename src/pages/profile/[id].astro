---
import Layout from '../../layouts/Layout.astro';
import { USER_API } from 'astro:env/server';

export async function getStaticPaths() {
  const res = await fetch(`${USER_API}`);
  const data = await res.json();

  return data.map((user: any) => ({
    params: { id: String(user.id) }
  }));
}

const { id } = Astro.params;

const res = await fetch(`${USER_API}/${id}`);
const user = await res.json();
---

<Layout title="User Details">
  <main class="p-6 max-w-6xl mx-auto text-white space-y-8">
    <div class="flex flex-wrap gap-3">
      <a href="/profiles">
        <button class="flex items-center gap-2 bg-slate-700 hover:bg-green-700 px-4 py-2 rounded-md shadow transition">
          ← Back to list
        </button>
      </a>

      <form method="post" action={`/api/users/${id}?_method=PUT`} class="inline">
        <button type="submit" class="flex items-center gap-2 bg-slate-700 hover:bg-blue-700 px-4 py-2 rounded-md shadow transition">
          ✏️ Edit
        </button>
      </form>

      <form method="post" action={`/api/users/${id}?_method=DELETE`} onsubmit="return confirm('Are you sure?')" class="inline">
        <button type="submit" class="flex items-center gap-2 bg-slate-700 hover:bg-red-700 px-4 py-2 rounded-md shadow transition">
          🗑️ Delete
        </button>
      </form>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-800 rounded-xl p-6 shadow-xl">
      <div class="flex items-center justify-center">
        <img
          src={user.image}
          alt={user.name}
          class="rounded-xl w-64 h-64 object-cover shadow-lg border border-gray-700"
        />
      </div>

      <div class="flex flex-col justify-center space-y-4">
        <h2 class="text-2xl font-semibold text-white">{user.name}</h2>
        <p class="text-sm text-gray-400">📱 Cellphone: {user.cell}</p>
        <p class="text-sm text-gray-400">📧 Email: {user.email}</p>
      </div>
    </div>
  </main>
</Layout>
